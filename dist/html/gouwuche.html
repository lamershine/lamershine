<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="../css/gouwuche.css">
		<link rel="stylesheet" type="text/css" href="../css/style.css" />
		<link rel="stylesheet" type="text/css" href="../font/iconfont.css" />
		<meta content="IE=edge" http-equiv="X-UA-Compatible">
		<meta content="webkit" name="renderer">
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
		<meta content="width=device-width, initial-scale=1" name="viewport">
	</head>

	<body>
		<div id="root" style="width: 100%;height: 100%;">
			<div class="header">
				<div class="header-top">
					<div class="header-top-content">

						<h1><a href="" ><img src="../imgs/$JJP1PQ)ISMOAEYH}~2V4AB.png"/></a></h1>
						<ul class="head-top-ul">
							<li>
								<a href="index.html" style="color: #acb2e0;">首页</a>
							</li>
							<li>
								<a href="" style="padding: 0 30px;" class="nav">游戏 &or;</a>
							</li>
							<li>
								<a href="">社区</a>
							</li>
							<li>
								<a href="" style="padding: 0 30px;" class="nav">周边 &or;</a>
							</li>
							<li>
								<a href="" style="padding: 0 20px;" class="nav">头条 &or;</a>
							</li>
							<li>
								<a href="">客户端</a>
							</li>
							<li>
								<a href="">国际站</a>
							</li>
						</ul>
						<div class="game-nav aa">
							<ol>
								<li>预售</li>
								<li>体育</li>
								<li>策略</li>
								<li>动作</li>
								<li>角色扮演</li>
								<li>竞速</li>
							</ol>
						</div>
						<div class="zhoubian-nav aa">
							<ol>
								<li>预售</li>
								<li>体育</li>
								<li>策略</li>
								<li>动作</li>
								<li>角色扮演</li>
								<li>竞速</li>
							</ol>
						</div>
						<div class="toutiao-nav aa">
							<ol>
								<li>预售</li>
								<li>体育</li>
								<li>策略</li>
								<li>动作</li>
								<li>角色扮演</li>
								<li>竞速</li>
							</ol>
						</div>
						<div class="header-info">
							<div class="links">
								<a href="login.html">登录</a>
								<span class="divide"></span>
								<a href="zhuce.html">注册</a>
							</div>
							<div class="search">
								<div class="search-type">
									<div class="search-type-title">
										商城
									</div>
									<ul class="search-type-hide">
										<li class="shangcheng">商城</li>
										<li class="shequ">社区</li>
										<li class="zhoubian">周边</li>
									</ul>
								</div>
								<div class="search-from">
									<span class="search-line"></span>
									<input type="text" class="search-text" placeholder="请输入关键字" />
									<span class="search-button">
										查找
									</span>
								</div>
							</div>
						</div>
					</div>
					<div class="header-foot">
						<div class="header-foot-content">
							您的位置:
							<a>购物车</a>
						</div>
					</div>
				</div>
			</div>
			<div class="cart-container">
				<div class="cart-title">
					购物车
				</div>
				<div class="cart-content">
					<div class="head">
						<div class="checks">
							<input type="checkbox" class="guojizhan" />
							<span>国际站</span>
						</div>
						<div class="names">
							游戏
						</div>
						<div class="tager">
							商品类型
						</div>
						<div class="prices">
							商品价格
						</div>
						<div class="opers">
							操作
						</div>
					</div>
					<div class="main">
						<!--<div class="game-item">
							<div class="check tags">
								<input type="checkbox" class="check" />
								<a href="">
									<img src="https://s1-rc.sonkwo.com/medium/910135728720663/file/40266/sonkwo-top-L-%E6%AD%BB%E6%88%96%E7%94%9F6.jpg?imageView2/2/w/135/h/80" />
								</a>
							</div>
							<div class="name tags">
								死或生
							</div>
							<div class="tag tags">
								普通游戏
							</div>
							<div class="price tags">
								￥128
							</div>
							<div class="oper tags">
								删除
							</div>
						</div>
						<div class="game-item">
							<div class="check tags">
								<input type="checkbox" class="check" />
								<a href="">
									<img src="https://s1-rc.sonkwo.com/medium/910135728720663/file/40266/sonkwo-top-L-%E6%AD%BB%E6%88%96%E7%94%9F6.jpg?imageView2/2/w/135/h/80" />
								</a>
							</div>
							<div class="name tags">
								死或生
							</div>
							<div class="tag tags">
								普通游戏
							</div>
							<div class="price tags">
								￥128
							</div>
							<div class="oper tags">
								删除
							</div>
						</div>
						<div class="game-item">
							<div class="check tags">
								<input type="checkbox" class="check" />
								<a href="">
									<img src="https://s1-rc.sonkwo.com/medium/910135728720663/file/40266/sonkwo-top-L-%E6%AD%BB%E6%88%96%E7%94%9F6.jpg?imageView2/2/w/135/h/80" />
								</a>
							</div>
							<div class="name tags">
								死或生
							</div>
							<div class="tag tags">
								普通游戏
							</div>
							<div class="price tags">
								￥128
							</div>
							<div class="oper tags">
								删除
							</div>
						</div>-->
					</div>
					<div class="footer">
						<div class="select-all">
							<input type="checkbox" name="quanxuan" />
							<span>全选</span>
						</div>
						<div class="total">
							<div class="total-game-count">
								共<span>0</span>款游戏
							</div>
							<div class="total-price">
								总价:￥<span>0</span>
							</div>
							<div class="submit">
								确认
							</div>
						</div>
					</div>
				</div>
			</div>
			<script src="../script/ajax.js" type="text/javascript" charset="utf-8"></script>
			<script src="../script/jquery-1.8.3.js" type="text/javascript" charset="utf-8"></script>
			<script>
				$(function() {
					// 判断购物车是否有数据
					if(localStorage.getItem('goods')) {
						// 本地存储中购物车的数据
						var goodsData = JSON.parse(localStorage.getItem('goods'));
						// 根据商品code获取数据
						$.ajax({
							url: '../json/list.json',
							type: 'get',
							dataType: 'json',
							success: function(json) {
								$.each(goodsData, function(index, item) {
									$.each(json, function(i, obj) {
										if(obj.code == item.code) {
											var goodsDom =
												'<div class="game-item">' +
												'<div class="check tags">' +
												'<input type="checkbox" class="checks" name="xuan"/>' +
												'<a href=""><img src="' + obj.img1 + '" />' +
												'</a>' +
												'</div>' +
												'<div class="name tags">' + obj.game + '</div>' +
												'<div class="tag tags">普通游戏</div>' +
												'<div class="price tags">' + obj.price + '</div>' +
												'<div class="oper tags" code="' + obj.code + '">删除</div>' +
												'</div>'

											$('.main').append(goodsDom);
										}
									})
								})
							}
						})
						document.addEventListener('click', function(e) {
							var e = e || window.event
							var target = e.target
							if(target.name == 'quanxuan') {
								var xuanlist = $('.main .checks')
								var quanxuan = document.getElementsByName('quanxuan')[0]
								for(var i = 0; i < xuanlist.length; i++) {
									if(quanxuan.checked == true) {
										xuanlist[i].checked = true
									} else {
										xuanlist[i].checked = false
									}
								}
								xuanze()
								zong()
							}

							if(target.className == 'oper tags') {
								var operdom = target.parentNode
								operdom.remove()
								var code = $(target).attr('code')
								$.each(goodsData, function(index, item) {
									// console.log(item);
									if(item.code == code) {
										goodsData.splice(index, 1); //删除本地存储中的数据
										return false;
									}
								})
								if(goodsData.length > 0) {
									// 更新本地存储中的数据
									localStorage.setItem('goods', JSON.stringify(goodsData));
								} else {
									localStorage.removeItem('goods')
									var noData = '<div style="line-height:80px;text-align:center;font-size:24px;">这里空空如也，请前往游戏商城购买</div>';
									$('.cart-content').remove()
									$('.cart-container').append(noData);
								}
								xuanze()
								zong()
							}

							if(target.name == 'xuan') {
								xuanze()
								zong()
							}

							function xuanze() {
								var aaa = document.querySelector('.total-game-count').querySelector('span')
								var xuanlist = $('.main .checks')
								var sum1 = 0
								var quanxuan = document.getElementsByName('quanxuan')[0]
								for(var i = 0; i < xuanlist.length; i++) {
									if(xuanlist[i].checked == true) {
										sum1++
									}
									aaa.innerHTML = sum1
								}
								if(sum1 < xuanlist.length) {
									quanxuan.checked = false
								} else {
									quanxuan.checked = true
								}

							}

							function zong() {
								var bbb = document.querySelector('.total-price').querySelector('span')
								var price = document.querySelectorAll('.price')
								var xuanlist = $('.main .checks')
								var sum2 = 0
								console.log(price[0].innerText)
								for(i = 0; i < price.length; i++) {
									if(xuanlist[i].checked == true) {
										var xiaoji = price[i].innerText
										sum2 += parseFloat(xiaoji.replace("￥", ""))
									}
								}
								bbb.innerHTML = sum2
							}
						});
					} else {
						var noData = '<div style="line-height:80px;text-align:center;font-size:24px;">这里空空如也，请前往游戏商城购买</div>';
						$('.cart-content').remove()
						$('.cart-container').append(noData);
					}
					$('.submit').on('click', function() {
						console.log(111)
						var zongjia = document.querySelector('.total-price').querySelector('span').innerHTML
						console.log(zongjia)
						localStorage.setItem('price',zongjia);
						if(zongjia>0) {
							location.href = 'tiaozhuan1.html'
						} else {
							alert('买不起就滚')
						}
					})

				})

				function loaddata() {
					var links = document.querySelector('.links')
					var theme = localStorage.getItem('username')
					if(!theme == null || !theme == "") {
						links.innerHTML = '<h4>欢迎<b>' + theme + '</b>回来<h5 class="exit">退出登录</h5></h4>'

					} else {
						links.innerHTML = '<a href="login.html">登录</a>' +
							'<span class="divide"></span>' +
							'<a href="zhuce.html">注册</a>'
					}
				}
				loaddata()
				var exit = document.querySelector('.exit')
				exit.onclick = function() {
					localStorage.removeItem("username");
					loaddata();
				}
			</script>
	</body>

</html>